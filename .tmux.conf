# 256 colors
set -g default-terminal "screen-256color"

# C-b is not acceptable -- Vim uses it
set-option -g prefix C-a
bind-key C-a last-window

# Start numbering at 1
set -g base-index 1

# Allows for faster key repetition
set -s escape-time 0

# Set status bar
set -g status-bg black
set -g status-fg white
set -g status-left ""
set -g status-right "#[fg=green]#H"

# Rather than constraining window size to the maximum size of any client 
# connected to the *session*, constrain window size to the maximum size of any 
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on

# Allows us to use C-a a <command> to send commands to a TMUX session inside 
# another TMUX session
bind-key a send-prefix

# Activity monitoring
#setw -g monitor-activity on
#set -g visual-activity on

# Example of using a shell command in the status line
#set -g status-right "#[fg=yellow]#(uptime | cut -d ',' -f 2-)"

# Highlight active window
set-window-option -g window-status-current-bg red

# Mouse mode
# Toggle mouse
bind-key m \
  set -g mode-mouse on \;\
  set -g mouse-resize-pane on \;\
  set -g mouse-select-pane on \;\
  set -g mouse-select-window on \;\
  display 'Mouse: ON'

# Toggle mouse off
bind-key M \
  set -g mode-mouse off \;\
  set -g mouse-resize-pane off \;\
  set -g mouse-select-pane off \;\
  set -g mouse-select-window off \;\
  display 'Mouse: OFF'

# Sane scrolling
set -g terminal-overrides 'xterm*:smcup@:rmcup@'

# scrollback buffer n lines
set -g history-limit 50000

# copy buffer to clipboard
#
# http://unix.stackexchange.com/questions/77355/tmux-xclip-copy-no-longer-working
# http://unix.stackexchange.com/questions/131011/use-system-clipboard-in-vi-copy-mode-in-tmux
# http://sourceforge.net/p/tmux/tmux-code/ci/master/tree/FAQ
#
#     sudo apt-get install xsel
#
#set-window-option mode-keys vi
unbind-key p              # previous window
bind-key   p paste-buffer

# vi like copy paste behaviour
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi C-v send -X rectangle-toggle \; send -X begin-selection
#bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -i -l 1 -selection clipboard > /dev/null" \; display-message "highlighted selection is copied"
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "xsel -ib > /dev/null" \; display-message "highlighted selection is copied"

# move x clipboard into tmux paste buffer
#bind-key C-p run "tmux set-buffer \"$(xclip -o -selection clipboard)\"; tmux paste-buffer"
bind-key C-p run "tmux set-buffer \"$(xsel -ob)\"; tmux paste-buffer"
# # move tmux copy buffer into x clipboard
#bind-key C-y run "tmux save-buffer - | xclip -i -l 1 -selection clipboard"
#bind-key C-y run "tmux save-buffer - | xsel -ib > /dev/null"

# for current directory 1.9
# http://unix.stackexchange.com/questions/12032/create-new-window-with-current-directory-in-tmux
bind-key '"' split-window -c "#{pane_current_path}"
bind-key % split-window -h -c "#{pane_current_path}"
bind-key c new-window -c "#{pane_current_path}"

# for 1.9a
bind-key S choose-window "join-pane -v -s "%%""
bind-key V choose-window "join-pane -h -s "%%""

# Use Alt-arrow keys without prefix key to switch panes
# https://gist.github.com/spicycode/1229612
# https://superuser.com/questions/238545/binding-a-command-in-tmux-without-using-the-prefix-key
#bind -n M-Left  select-pane -L
#bind -n M-Right select-pane -R
#bind -n M-Up    select-pane -U
#bind -n M-Down  select-pane -D
bind -n C-Left  select-pane -L
bind -n C-Right select-pane -R
bind -n C-Up    select-pane -U
bind -n C-Down  select-pane -D

# Shift arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# Shift arrow to switch session
# check key and command using :list-keys
bind -n C-S-Left  switch-client -p
bind -n C-S-Right switch-client -n

# Reload tmux config
bind r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"
#bind-key M split-window -h "vim ~/.tmux.conf"

# SEE ALSO
# https://gist.github.com/andreyvit/2921703
# https://gist.github.com/Starefossen/5955406
# https://gist.github.com/MohamedAlaa/2961058
# https://gist.github.com/spicycode/1229612
# https://superuser.com/questions/1105090/move-a-tmux-pane-to-another-session/1105100
# https://superuser.com/questions/238545/binding-a-command-in-tmux-without-using-the-prefix-key
# https://github.com/kbknapp/dotfiles/blob/master/byobu/f-keys.tmux
# https://superuser.com/questions/550469/how-to-use-fn-keys-in-tmux
# http://hyperpolyglot.org/multiplexers
# https://robots.thoughtbot.com/a-tmux-crash-course
# https://til.hashrocket.com/posts/d4d3c1fea6-quickly-edit-and-reload-tmux-configuration
# https://devel.tech/tips/n/tMuXm4vP/reloading-config-from-inside-tmux/
# https://github.com/tmux/tmux/issues/592
# https://blogs.technet.microsoft.com/jessicadeen/linux/tmux-2-6-copypaste-and-bind-tips-and-tricks/
# https://superuser.com/a/197272
# https://superuser.com/a/1255267
